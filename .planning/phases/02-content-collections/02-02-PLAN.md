---
phase: 02-content-collections
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/payload/collections/Destinations.ts
  - src/payload/collections/Boats.ts
  - src/payload/collections/Categories.ts
  - src/payload/collections/Tags.ts
  - payload.config.ts
autonomous: true

must_haves:
  truths:
    - "Editor can create/edit/delete destinations with name, description, image, and region"
    - "Editor can create/edit/delete boats with specs, deck plan, and cabin array (category, size, capacity, amenities, images)"
    - "Editor can create/edit/delete blog categories and tags"
    - "Boat cabin rows are sortable via drag-and-drop in admin"
    - "Admin sidebar groups Destinations and Boats under 'Croisieres' and Categories/Tags under 'Blog'"
  artifacts:
    - path: "src/payload/collections/Destinations.ts"
      provides: "Destinations collection with name, slug, description, image, region"
      exports: ["Destinations"]
    - path: "src/payload/collections/Boats.ts"
      provides: "Boats collection with specs, deck plan, cabin array field"
      exports: ["Boats"]
    - path: "src/payload/collections/Categories.ts"
      provides: "Blog categories collection"
      exports: ["Categories"]
    - path: "src/payload/collections/Tags.ts"
      provides: "Blog tags collection"
      exports: ["Tags"]
  key_links:
    - from: "payload.config.ts"
      to: "src/payload/collections/Destinations.ts"
      via: "import and collections array registration"
      pattern: "import.*Destinations"
    - from: "payload.config.ts"
      to: "src/payload/collections/Boats.ts"
      via: "import and collections array registration"
      pattern: "import.*Boats"
    - from: "src/payload/collections/Boats.ts"
      to: "src/payload/hooks/formatSlug.ts"
      via: "field hook import for slug field"
      pattern: "import.*formatSlug"
    - from: "src/payload/collections/Boats.ts"
      to: "src/payload/collections/Media.ts"
      via: "upload relationship for cabin images"
      pattern: "relationTo.*media"
---

<objective>
Create Destinations, Boats (with cabin specifications array), Categories, and Tags collections to complete the entity foundation needed by Blog Posts and Cruises.

Purpose: Build the entity collections that other collections depend on (Cruises need Destinations + Boats, Posts need Categories + Tags). Boats introduces the array field pattern for cabin specs.
Output: 4 working collections registered in Payload admin.
</objective>

<execution_context>
@/Users/fredericgueirard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/fredericgueirard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-content-collections/02-RESEARCH.md
@.planning/phases/02-content-collections/02-01-SUMMARY.md
@payload.config.ts
@src/payload/hooks/formatSlug.ts
@src/payload/collections/Media.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Destinations and Boats collections</name>
  <files>
    src/payload/collections/Destinations.ts
    src/payload/collections/Boats.ts
  </files>
  <action>
**Destinations collection** (`src/payload/collections/Destinations.ts`):
- slug: 'destinations'
- admin.useAsTitle: 'name', admin.group: 'Croisieres', admin.defaultColumns: ['name', 'region', 'updatedAt']
- Fields:
  - `name`: text, required, label 'Nom de la destination' (e.g., "Grèce et Turquie")
  - `slug`: text, required, unique, index: true, hooks.beforeValidate: [formatSlug('name')]
  - `region`: select, required, label 'Région', options: [
      { label: 'Méditerranée', value: 'mediterranee' },
      { label: 'Europe du Nord', value: 'europe-nord' },
      { label: 'Europe Centrale', value: 'europe-centrale' },
      { label: 'Asie', value: 'asie' },
      { label: 'Afrique', value: 'afrique' },
      { label: 'Autre', value: 'autre' }
    ]
  - `description`: richText, required, label 'Description'
  - `excerpt`: textarea, label 'Résumé court', admin.description: 'Pour les vignettes et le SEO (160 caractères max)'
  - `featuredImage`: upload, relationTo: 'media', required, label 'Image mise en avant'
  - `gallery`: upload, relationTo: 'media', hasMany: true, label 'Galerie photos'
- Access: read () => true, create/update ({ req: { user } }) => !!user, delete ({ req: { user } }) => user?.role === 'admin'

**Boats collection** (`src/payload/collections/Boats.ts`):
- slug: 'boats'
- admin.useAsTitle: 'name', admin.group: 'Croisieres', admin.defaultColumns: ['name', 'capacity', 'updatedAt']
- Fields:
  - `name`: text, required, label 'Nom du bateau' (e.g., "Amadeus Diamond")
  - `slug`: text, required, unique, index: true, hooks.beforeValidate: [formatSlug('name')]
  - `featuredImage`: upload, relationTo: 'media', required, label 'Photo principale'
  - `description`: richText, required, label 'Description'
  - `capacity`: number, required, label 'Capacité (passagers)', min: 1
  - `crew`: number, label 'Nombre d\'équipage'
  - `length`: number, label 'Longueur (m)'
  - `builtYear`: number, label 'Année de construction', min: 1900, max: 2100
  - `renovatedYear`: number, label 'Année de rénovation', min: 1900, max: 2100
  - `deckPlan`: upload, relationTo: 'media', label 'Plan des ponts'
  - `gallery`: upload, relationTo: 'media', hasMany: true, label 'Galerie photos'
  - `cabins`: array, label 'Cabines', minRows: 1, fields: [
      { name: 'category', type: 'text', required: true, label: 'Catégorie', admin.placeholder: 'ex: Suite Deluxe, Cabine Standard' },
      { name: 'size', type: 'number', required: true, label: 'Surface (m²)' },
      { name: 'capacity', type: 'number', required: true, label: 'Capacité (personnes)', defaultValue: 2 },
      { name: 'count', type: 'number', required: true, label: 'Nombre de cabines de ce type' },
      { name: 'amenities', type: 'textarea', label: 'Équipements', admin.placeholder: 'Un équipement par ligne' },
      { name: 'images', type: 'upload', relationTo: 'media', hasMany: true, label: 'Photos de la cabine' }
    ]
- Access: read () => true, create/update ({ req: { user } }) => !!user, delete ({ req: { user } }) => user?.role === 'admin'
  </action>
  <verify>
- Both files exist and export CollectionConfig
- TypeScript compiles without errors in these files
- Boats collection has cabins array field with 6 sub-fields
  </verify>
  <done>Destinations and Boats collections created with all fields. Boats includes cabin array with drag-and-drop sortable rows.</done>
</task>

<task type="auto">
  <name>Task 2: Create Categories and Tags collections, register all in config</name>
  <files>
    src/payload/collections/Categories.ts
    src/payload/collections/Tags.ts
    payload.config.ts
  </files>
  <action>
**Categories collection** (`src/payload/collections/Categories.ts`):
- slug: 'categories'
- admin.useAsTitle: 'name', admin.group: 'Blog', admin.defaultColumns: ['name', 'updatedAt']
- Fields:
  - `name`: text, required, label 'Nom de la catégorie'
  - `slug`: text, required, unique, index: true, hooks.beforeValidate: [formatSlug('name')]
  - `description`: textarea, label 'Description'
- Access: read () => true, create/update/delete ({ req: { user } }) => user?.role === 'admin'
  (Only admins manage taxonomy, not editors)

**Tags collection** (`src/payload/collections/Tags.ts`):
- slug: 'tags'
- admin.useAsTitle: 'name', admin.group: 'Blog', admin.defaultColumns: ['name', 'updatedAt']
- Fields:
  - `name`: text, required, label 'Nom du tag'
  - `slug`: text, required, unique, index: true, hooks.beforeValidate: [formatSlug('name')]
- Access: read () => true, create/update/delete ({ req: { user } }) => user?.role === 'admin'

**Register in payload.config.ts:**
- Import Destinations, Boats, Categories, Tags from src/payload/collections/
- Add to existing collections array (after Users, Media, Speakers, Team, Testimonials from Plan 01)
- Keep existing config unchanged
  </action>
  <verify>
- `npm run build` completes without errors
- payload.config.ts has all 4 new imports and collections registered
- Navigate to /admin -- Destinations and Boats appear under 'Croisieres', Categories and Tags under 'Blog'
  </verify>
  <done>4 new collections registered and visible in admin. Destinations/Boats under 'Croisieres' group. Categories/Tags under 'Blog' group. Boat cabins support drag-and-drop array rows.</done>
</task>

</tasks>

<verification>
1. `npm run build` passes with zero errors
2. Navigate to /admin -- 4 new collections visible in correct sidebar groups
3. Create a destination "Grèce et Turquie" -- slug auto-generates as "grece-et-turquie"
4. Create a boat with 2 cabin types (Suite Deluxe 25m², Cabine Standard 14m²) -- verify cabin array with images
5. Create a category "Destinations" and a tag "Méditerranée" -- verify slug generation
6. Verify drag-and-drop reordering works on boat cabin rows
</verification>

<success_criteria>
- Destinations and Boats collections functional with all specified fields
- Boat cabin array supports multiple cabin types with photos
- Categories and Tags collections functional for blog taxonomy
- All collections properly grouped in admin sidebar (Croisieres, Blog)
- Build passes cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/02-content-collections/02-02-SUMMARY.md`
</output>
