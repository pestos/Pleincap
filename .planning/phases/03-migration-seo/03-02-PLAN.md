---
phase: 03-migration-seo
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/scripts/seed/seed-destinations.ts
  - src/scripts/seed/seed-boats.ts
  - src/app/(frontend)/nos-conferenciers/page.tsx
  - src/app/(frontend)/equipe/page.tsx
  - src/app/(frontend)/livre-d-or/page.tsx
autonomous: true

must_haves:
  truths:
    - "Destinations and Boats collections have data in the database"
    - "Speakers page displays data from CMS instead of hardcoded array"
    - "Team page displays data from CMS instead of hardcoded array"
    - "Testimonials page displays data from CMS instead of hardcoded array"
    - "All 3 replaced pages render identically to their previous hardcoded versions"
    - "URLs /nos-conferenciers, /equipe, /livre-d-or remain identical"
  artifacts:
    - path: "src/scripts/seed/seed-destinations.ts"
      provides: "Migration script for destinations from DestinationsClient data"
    - path: "src/scripts/seed/seed-boats.ts"
      provides: "Migration script for 4 boats from nos-bateaux page"
    - path: "src/app/(frontend)/nos-conferenciers/page.tsx"
      provides: "Speakers page fetching from Payload Local API"
    - path: "src/app/(frontend)/equipe/page.tsx"
      provides: "Team page fetching from Payload Local API"
    - path: "src/app/(frontend)/livre-d-or/page.tsx"
      provides: "Testimonials page fetching from Payload Local API"
  key_links:
    - from: "src/app/(frontend)/nos-conferenciers/page.tsx"
      to: "src/lib/payload-queries.ts"
      via: "getSpeakers() import"
      pattern: "getSpeakers"
    - from: "src/app/(frontend)/equipe/page.tsx"
      to: "src/lib/payload-queries.ts"
      via: "getTeamMembers() import"
      pattern: "getTeamMembers"
    - from: "src/app/(frontend)/livre-d-or/page.tsx"
      to: "src/lib/payload-queries.ts"
      via: "getTestimonials() import"
      pattern: "getTestimonials"
---

<objective>
Seed Destinations and Boats collections, and replace Speakers, Team, and Testimonials pages with CMS data.

Purpose: Continue incremental migration by seeding the next batch of independent collections (Destinations, Boats) while simultaneously converting the first 3 frontend pages (Speakers, Team, Testimonials) to fetch data from CMS instead of hardcoded arrays. This validates the full pipeline: seed -> query -> render.

Output: 2 seed scripts + 3 converted pages. Pages render dynamically from CMS data.
</objective>

<execution_context>
@/Users/fredericgueirard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/fredericgueirard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-migration-seo/03-RESEARCH.md
@.planning/phases/03-migration-seo/03-01-SUMMARY.md
@src/payload/collections/Destinations.ts
@src/payload/collections/Boats.ts
@src/lib/payload-queries.ts
@src/app/(frontend)/nos-conferenciers/page.tsx
@src/app/(frontend)/equipe/page.tsx
@src/app/(frontend)/livre-d-or/page.tsx
@src/app/(frontend)/destinations/DestinationsClient.tsx
@src/app/(frontend)/nos-bateaux/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Seed Destinations and Boats collections</name>
  <files>
    src/scripts/seed/seed-destinations.ts
    src/scripts/seed/seed-boats.ts
  </files>
  <action>
Create seed scripts for Destinations and Boats using the same pattern established in 03-01.

**seed-destinations.ts**: Extract the 7 regions from `DestinationsClient.tsx`:
- Each region has: `area`, `title`, `itineraries`, `image`, `continent`
- Map to Destinations collection: `name` = `title` (e.g., "GrÃ¨ce & Iles"), `region` = map continent to the select options in Destinations.ts (Europe -> mediterranee/europe-nord/europe-centrale, Afrique -> afrique, Asie -> asie, other -> autre)
- `description` field is richText required - generate a brief description from the `area` field: "Discover {area} - {itineraries} itineraries available"
- `excerpt` = area description from `continentCopy` or generate from data
- `featuredImage` = upload from image URL using the shared `uploadMediaFromUrl` helper from 03-01's utils.ts
- Check for duplicates by slug before creating

**seed-boats.ts**: Extract the 4 ships from `nos-bateaux/page.tsx`:
- Each ship has: `name`, `tag`, `atmosphere`, `capacity`, `decks`, `image`
- Map to Boats collection: `name`, `capacity` = parse number from string (e.g., "144 Passagers" -> 144), `featuredImage` = upload from URL
- `description` = richText from `atmosphere` text
- Cabin data is NOT in the listing page (only in detail pages like amadeus-diamond). For now, leave cabins empty. Cabin data will be added when detail pages are converted.
- Check for duplicates by slug before creating

Both scripts follow the same idempotent pattern: check for existing by slug, skip if found, create if not.
  </action>
  <verify>
Run seed scripts:
```bash
npx tsx src/scripts/seed/seed-destinations.ts
npx tsx src/scripts/seed/seed-boats.ts
```
Verify data:
```bash
curl http://localhost:3000/api/destinations | jq '.totalDocs'
curl http://localhost:3000/api/boats | jq '.totalDocs'
```
Expected: destinations=7, boats=4
  </verify>
  <done>
Database contains 7 destinations and 4 boats with featured images. Seed scripts are idempotent.
  </done>
</task>

<task type="auto">
  <name>Task 2: Replace Speakers, Team, and Testimonials pages with CMS data</name>
  <files>
    src/app/(frontend)/nos-conferenciers/page.tsx
    src/app/(frontend)/equipe/page.tsx
    src/app/(frontend)/livre-d-or/page.tsx
  </files>
  <action>
Convert 3 pages from hardcoded arrays to Payload Local API queries. The design/layout must remain IDENTICAL - only the data source changes.

**Critical rules:**
1. Remove the `'use client'` directive if present - these become Server Components that fetch data server-side
2. Remove hardcoded data arrays (const experts = [...], const team = [...], const reviews = [...])
3. Import query functions from `@/lib/payload-queries`
4. Make the page component `async` to use `await`
5. Keep ALL existing JSX structure, Tailwind classes, and component breakdown exactly the same
6. Map CMS field names to the JSX template (e.g., `speaker.specialty` instead of `expert.title`, `member.jobTitle` instead of `member.role`)
7. For richText fields (bio), render as plain text for now using a simple extraction: `doc.bio?.root?.children?.[0]?.children?.[0]?.text || ''`
8. For media/upload fields (photo, authorPhoto), use the media object's URL: `speaker.photo?.url` or `speaker.photo?.thumbnailURL`
9. Preserve the `metadata` export (title, description) on each page
10. URLs must stay identical: `/nos-conferenciers`, `/equipe`, `/livre-d-or`

**nos-conferenciers/page.tsx:**
- Remove `'use client'` if client-side features are only for filtering (the current page has no actual interactive filtering that works - the filter UI is decorative)
- Make `NosConferenciersPage` async, call `const speakers = await getSpeakers()`
- The Drawer component has hardcoded "Jean-Pierre Vallat" data - this will need to be handled. For now, keep the Drawer static (it's a detail panel that will be addressed when dynamic detail pages are created)
- Map: `expert.name` -> `speaker.name`, `expert.title` -> `speaker.specialty`, `expert.tag` -> derive from specialty or hardcode "Expert", `expert.topics` -> not in CMS, skip or derive from specialty, `expert.desc` -> extract text from `speaker.bio` richText, `expert.image` -> `speaker.photo?.url || speaker.photo?.thumbnailURL`
- **Note**: The Speakers collection doesn't have `tag` or `topics` fields. These were UI-only decorations in the hardcoded data. For the tag, use the `specialty` field. For topics, omit them (or derive from specialty text).

**equipe/page.tsx:**
- Make `EquipePage` async, call `const members = await getTeamMembers()`
- Map: `member.name` -> same, `member.role` -> `member.jobTitle`, `member.quote` -> not in CMS (skip quote rendering or keep static), `member.longBio` -> extract text from `member.bio` richText, `member.image` -> `member.photo?.url`, `member.layout` -> not in CMS (use default aspect ratio)
- **Note**: The Team collection doesn't have `quote` or `layout` fields. The quote can be omitted or kept as a static design element. For layout, use a uniform card layout.

**livre-d-or/page.tsx:**
- Make `LivreDOrPage` async, call `const testimonials = await getTestimonials()`
- Map: `r.author` -> `t.authorName`, `r.text` -> `t.content`, `r.meta` -> `t.cruiseName`, `r.image` -> `t.authorPhoto?.url`, `r.id` -> `t.id`
- The `gallery` and `inspired` arrays are NOT testimonials - they are decorative sections. Keep them hardcoded (or remove them if they add no value). The `inspired` array links to cruises that don't exist yet in CMS.
- The `reviews` checkbox expand/collapse pattern uses `peer` CSS - this works with Server Components since it's pure CSS, not JS.
  </action>
  <verify>
1. Start the dev server: `npm run dev`
2. Visit http://localhost:3000/nos-conferenciers - should display 6 speakers from CMS
3. Visit http://localhost:3000/equipe - should display 7 team members from CMS
4. Visit http://localhost:3000/livre-d-or - should display 6 testimonials from CMS
5. Compare visual output to previous hardcoded versions (layout identical)
6. Verify no hardcoded data arrays remain in the 3 files
7. Run `npx next build` to verify build succeeds
  </verify>
  <done>
Three pages (/nos-conferenciers, /equipe, /livre-d-or) render content from Payload CMS database. No hardcoded content arrays remain in these files. URLs are preserved. Layout is identical.
  </done>
</task>

</tasks>

<verification>
1. Database has 7 destinations and 4 boats
2. /nos-conferenciers renders 6 speakers from CMS
3. /equipe renders 7 team members from CMS
4. /livre-d-or renders 6 testimonials from CMS
5. No hardcoded data arrays in the 3 converted page files
6. URLs remain identical (no 404s)
7. Build succeeds
</verification>

<success_criteria>
- Destinations and Boats seeded in database
- 3 frontend pages display CMS data instead of hardcoded arrays
- Visual output identical to previous version
- All URLs preserved
- Build succeeds without errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-migration-seo/03-02-SUMMARY.md`
</output>
